# Geval Quality Contract
# This defines the quality requirements for AI deployment

version: 1
name: ai-quality-gate
description: Quality requirements for production AI deployment
environment: production

# ═══════════════════════════════════════════════════════════════════════════════
# SOURCES: How to parse different eval result formats
# These configs tell Geval how to extract metrics from CSV/JSON files
# ═══════════════════════════════════════════════════════════════════════════════
sources:
  # Config for CSV files (e.g., LangSmith exports)
  csv:
    metrics:
      - column: accuracy
        aggregate: avg
      - column: latency
        aggregate: p95
        as: latency_p95           # Rename to match rule metric name
      - column: hallucination_detected
        aggregate: fail_rate      # Convert boolean to rate
        as: hallucination_rate    # Rename to match rule metric name
      - column: status
        aggregate: pass_rate
    evalName:
      fixed: quality-metrics      # Must match required_evals name

  # Config for JSON files (optional - also works with JSON)
  json:
    metrics:
      - column: accuracy
        aggregate: avg
      - column: latency_p95
        aggregate: first
      - column: hallucination_rate
        aggregate: avg
    evalName:
      fixed: quality-metrics

# ═══════════════════════════════════════════════════════════════════════════════
# RULES: What must pass before shipping
# ═══════════════════════════════════════════════════════════════════════════════
required_evals:
  - name: quality-metrics
    description: Core quality metrics that must be met
    rules:
      # Accuracy must be at least 85%
      - metric: accuracy
        operator: ">="
        baseline: fixed
        threshold: 0.85
        description: Model accuracy must meet minimum threshold

      # Latency p95 must be under 500ms
      - metric: latency_p95
        operator: "<="
        baseline: fixed
        threshold: 500
        description: 95th percentile latency must be acceptable

      # Hallucination rate must be under 5%
      - metric: hallucination_rate
        operator: "<="
        baseline: fixed
        threshold: 0.05
        description: Hallucination rate must be minimal

on_violation:
  action: block
  message: "Quality metrics did not meet production requirements. Please review and fix before deploying."
